<html>
  <head>
    <title>Socket.IO Test</title>
    <link rel="stylesheet" href="/bower_components/bootstrap/css/bootstrap.min.css">
    <script src="/bower_components/bootstrap/js/bootstrap.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script>
      var fnucs = {
        remove: function(list) {
          d3.select("#result")
            .select("tr")
            .remove();
        },
      };
      var list = [];

      $(function() {
        var socket = io.connect();
        socket.on('publish', function(data, fn) {
          var line = [];
          line.push(1);
          line.push(data);
          console.log(line);
          list.push(line);

          if(list.length > 10) { list.shift(); }
          var table = d3.select('#result>tbody')
            .selectAll('tr')
            .data(list);
          table.enter().append('tr');
          table.exit().remove();

          var cells = table.selectAll('td')
            .data(function(d) { console.log("cells:" + d); return d });
          cells.enter()
            .append('td')
            .text(function(d) { console.log("td:" + d); return d });
          cells.text(function(d) { console.log("td:" + d); return d });
          cells.exit().remove();
        });

        socket.on('greeting', function(data, fn) {
          var answer = confirm(data.message);
          fn(answer);

          var table = d3.select('#result');
          var thead = table.append('thead'); //theadタグ追加
          var tbody = table.append('tbody'); //tbodyタグ追加
        });
      });
    </script>
    <style>
    .table {
        display: inline-block;
        background-color: blue;
        border-width: 1px;
        border-style: solid;
    }
    </style>
  </head>
  <body>
    <h1>Socket.IO Test</h1>
    <table id="result"></table>
  </body>
</html>
